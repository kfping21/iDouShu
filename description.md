# iDouShu 社交平台后端项目说明文档

## 1. 项目概述

### 1.1 项目背景
iDouShu 是一个仿小红书风格的社交分享平台后端系统，作为软件工程与项目实践课程的服务器开发部分。项目旨在构建一个完整的社交平台后端，支持用户内容分享、社交互动等核心功能。

### 1.2 项目目标
本项目致力于实现一个功能完整的社交平台后端系统，提供用户管理、内容发布、社交互动等核心功能。系统采用现代化的技术栈和架构设计，为前端应用提供稳定可靠的 API 接口，确保系统的高可用性和可扩展性。

### 1.3 技术选型
| 技术领域 | 技术选型 |
|---------|----------|
| 后端框架 | Spring Boot 3.5.6 |
| 数据库 | MySQL 9.0 |
| ORM框架 | Spring Data JPA + Hibernate |
| 构建工具 | Gradle |
| Java版本 | 21 |
| 数据库连接池 | HikariCP |

## 2. 系统架构

### 2.1 整体架构
表现层 (Controller) → 业务层 (Service) → 数据访问层 (Repository) → 数据库 (MySQL)

### 2.2 包结构说明
```plaintext
com.example.serveridoushu/
├── controller/ # REST API 控制器
├── service/ # 业务逻辑实现
├── repository/ # 数据访问接口
├── model/ # 实体类定义
├── dto/ # 数据传输对象
└── exception/ # 异常处理
```

## 3. 核心功能模块

### 3.1 用户管理模块
**功能描述**：用户管理模块负责处理用户注册、登录、资料管理等操作。该模块提供用户注册接口用于创建新用户账户，用户登录接口用于身份验证，个人资料获取和更新接口用于管理用户信息，以及用户设置接口用于配置账号偏好。在数据关系方面，用户与帖子建立一对多关系，与点赞记录建立一对多关系，与评论记录建立一对多关系，同时通过自关联的多对多关系实现用户间的关注功能。

**主要接口**：
- `POST /api/users/register` - 用户注册
- `POST /api/users/login` - 用户登录
- `GET /api/users/profile` - 获取用户资料
- `PUT /api/users/profile` - 更新用户资料
- `PUT /api/users/settings` - 更新用户设置

**实体关系**：
- User 与 Post：一对多关系
- User 与 Like：一对多关系
- User 与 Comment：一对多关系
- User 与 Follow：自关联多对多关系

### 3.2 内容管理模块
**功能描述**：内容管理模块专注于帖子的全生命周期管理，包括发布、查看、更新和删除等操作。该模块提供帖子创建接口用于发布新内容，帖子列表接口用于展示时间线内容，用户帖子查询接口用于获取特定用户的发帖记录，帖子详情接口用于查看具体内容，以及帖子更新和删除接口用于内容维护。

**主要接口**：
- `POST /api/posts/create` - 发布帖子
- `GET /api/posts` - 获取所有帖子（时间线）
- `GET /api/posts/user/{userId}` - 获取用户帖子
- `GET /api/posts/{id}` - 获取帖子详情
- `PUT /api/posts/{id}` - 更新帖子
- `DELETE /api/posts/{id}` - 删除帖子

### 3.3 社交互动模块

#### 3.3.1 点赞系统
**功能描述**：点赞系统负责处理用户对帖子的点赞互动行为。系统提供点赞接口用于记录用户的点赞操作，取消点赞接口用于撤销点赞，帖子点赞列表查询接口用于展示点赞用户信息，以及用户点赞记录查询接口用于查看用户的点赞历史。

**主要接口**：
- `POST /api/likes` - 点赞帖子
- `DELETE /api/likes` - 取消点赞
- `GET /api/likes/post/{postId}` - 获取帖子点赞列表
- `GET /api/likes/user/{userId}` - 获取用户点赞记录

#### 3.3.2 关注系统
**功能描述**：关注系统管理用户之间的社交关系网络。系统提供关注接口用于建立用户间的关注关系，取消关注接口用于解除关注关系，关注列表查询接口用于查看用户的关注对象，粉丝列表查询接口用于展示关注该用户的粉丝群体。

**主要接口**：
- `POST /api/follows` - 关注用户
- `DELETE /api/follows` - 取消关注
- `GET /api/follows/following/{userId}` - 获取关注列表
- `GET /api/follows/followers/{userId}` - 获取粉丝列表

#### 3.3.3 评论系统
**功能描述**：评论系统支持用户对帖子内容进行讨论交流。系统提供评论发表接口用于添加评论内容，评论更新接口用于修改已有评论，评论删除接口用于移除评论，以及帖子评论列表查询接口用于展示所有相关评论。

**主要接口**：
- `POST /api/comments` - 发表评论
- `PUT /api/comments/{commentId}` - 更新评论
- `DELETE /api/comments/{commentId}` - 删除评论
- `GET /api/comments/post/{postId}` - 获取帖子评论

## 4. 数据库设计

### 4.1 数据表结构

#### users 表（用户表）

| 字段名            | 类型         | 说明          | 约束                     |
|-------------------|--------------|---------------|--------------------------|
| id                | BIGINT       | 用户ID        | 主键，自增               |
| username          | VARCHAR(50)  | 用户名        | 唯一，非空               |
| password          | VARCHAR(100) | 密码          | 非空                     |
| email             | VARCHAR(100) | 邮箱          | 唯一                     |
| avatar_url        | VARCHAR(255) | 头像URL       |                          |
| nick_name         | VARCHAR(100) | 昵称          |                          |
| bio               | TEXT         | 个人简介      |                          |
| gender            | VARCHAR(10)  | 性别          |                          |
| birth_date        | VARCHAR(20)  | 生日          |                          |
| phone_number      | VARCHAR(20)  | 手机号        |                          |
| is_private        | BOOLEAN      | 是否私密账号  | 默认false                |
| notification_enabled | BOOLEAN    | 是否开启通知  | 默认true                 |
| created_at        | DATETIME     | 创建时间      |                          |
| updated_at        | DATETIME     | 更新时间      |                          |

#### posts 表（帖子表）

| 字段名            | 类型         | 说明          | 约束                     |
|-------------------|--------------|---------------|--------------------------|
| id                | BIGINT       | 帖子ID        | 主键，自增               |
| user_id           | BIGINT       | 用户ID        | 外键，非空               |
| title             | VARCHAR(200) | 标题          | 非空                     |
| content           | TEXT         | 内容          |                          |
| image_url         | VARCHAR(255) | 图片URL       |                          |
| created_at        | DATETIME     | 创建时间      |                          |

#### likes 表（点赞表）

| 字段名            | 类型         | 说明          | 约束                     |
|-------------------|--------------|---------------|--------------------------|
| id                | BIGINT       | 点赞ID        | 主键，自增               |
| user_id           | BIGINT       | 用户ID        | 外键，非空               |
| post_id           | BIGINT       | 帖子ID        | 外键，非空               |
| created_at        | DATETIME     | 创建时间      |                          |

#### follows 表（关注表）

| 字段名            | 类型         | 说明          | 约束                     |
|-------------------|--------------|---------------|--------------------------|
| id                | BIGINT       | 关注ID        | 主键，自增               |
| follower_id       | BIGINT       | 关注者ID      | 外键，非空               |
| followed_id       | BIGINT       | 被关注者ID    | 外键，非空               |
| created_at        | DATETIME     | 创建时间      |                          |

#### comments 表（评论表）

| 字段名            | 类型         | 说明          | 约束                     |
|-------------------|--------------|---------------|--------------------------|
| id                | BIGINT       | 评论ID        | 主键，自增               |
| user_id           | BIGINT       | 用户ID        | 外键，非空               |
| post_id           | BIGINT       | 帖子ID        | 外键，非空               |
| content           | TEXT         | 评论内容      | 非空                     |
| created_at        | DATETIME     | 创建时间      |                          |

### 4.2 数据关系图

用户 (User)

  │

  ├── 发布 → 帖子 (Post)
  
  │         │
  
  │         ├── 拥有 → 点赞 (Like) ← 属于 ── 用户 (User)
  
  │         │
  
  │         └── 拥有 → 评论 (Comment) ← 属于 ── 用户 (User)
  
  │
  
  ├── 关注 → 用户 (User) (通过 Follow 表)
  
  │
  
  └── 被关注 ← 用户 (User) (通过 Follow 表)

## 5. API 设计规范

### 5.1 请求响应格式

**成功响应**：
```json
{
  "message": "操作成功",
  "data": { ... },
  "timestamp": "2024-01-01T00:00:00"
}
```

**错误响应**
```json
{
  "error": "错误描述",
  "message": "详细错误信息",
  "timestamp": "2024-01-01T00:00:00"
}
```

### 5.2 状态码规范
- 200 - 请求成功

- 201 - 创建成功

- 400 - 请求参数错误

- 401 - 未授权

- 404 - 资源不存在

- 500 - 服务器内部错误

## 6. 业务逻辑设计
### 6.1 用户注册流程
用户注册流程首先验证用户名和邮箱的唯一性，确保不会出现重复账户。接着对密码强度进行校验，保证账户安全性。验证通过后创建用户记录并设置默认用户信息，包括初始化昵称和创建时间等字段，最后返回注册结果给客户端。

### 6.2 帖子发布流程
帖子发布流程首先验证用户身份确保操作合法性，然后对帖子内容进行合法性检查防止违规内容发布。系统自动设置帖子创建时间戳，将完整的帖子信息保存到数据库，最终返回发布结果通知用户操作状态。

### 6.3 点赞业务流程
点赞业务流程首先检查用户和帖子的存在性，确保操作对象的有效性。接着验证用户是否已经对该帖子点赞，防止重复点赞行为。确认无误后创建点赞记录并更新帖子的点赞数统计，保持数据的一致性。

## 7. 异常处理机制
### 7.1 全局异常处理
系统通过 @RestControllerAdvice 注解实现全局异常处理机制，统一处理各类异常情况。该机制能够捕获数据验证异常 MethodArgumentNotValidException，处理业务逻辑异常 RuntimeException，以及拦截系统级异常 Exception，确保系统的稳定性和友好的错误提示。

### 7.2 自定义异常
系统定义了一系列自定义异常类型来精确描述业务问题，包括用户已存在异常用于处理重复注册情况，资源不存在异常用于处理无效资源访问，权限不足异常用于控制访问权限，以及重复操作异常用于防止重复执行相同操作。

## 8. 数据初始化
### 8.1 初始化脚本
项目提供了完整的数据库初始化脚本支持，包括 schema.sql 文件用于创建数据库表结构，initiation.sql 文件用于插入测试数据，确保系统能够快速部署和运行。

### 8.2 测试数据
系统预置了丰富的测试数据，包含五类典型用户角色如美食博主、旅行博主、时尚博主和科技博主等，配套十五篇精选帖子内容模拟真实社交场景，同时建立了完整的点赞、关注和评论关系数据，为功能测试和演示提供全面支持。

## 9. 部署与运行
### 9.1 开发环境运行
```bash
# 克隆项目
git clone <repository-url>

# 配置数据库
# 修改 application.properties 中的数据库连接信息

# 运行项目
./gradlew bootRun
```

### 9.2 生产环境部署

```bash
# 打包项目
./gradlew clean build

# 运行jar包
java -jar build/libs/serveridoushu-0.0.1-SNAPSHOT.jar
```

## 10. 项目特色与创新点

### 10.1 技术特色

本项目在技术层面具有多个特色亮点，采用现代化的技术栈包括 Spring Boot 3.x 和 Java 17 确保系统性能。通过严格的分层架构设计实现职责分离，提高代码可维护性。实现了复杂的社交网络关系数据模型，支持丰富的用户互动场景。建立了健壮的异常处理机制，确保系统稳定运行。

### 10.2 业务特色

在业务功能方面，系统提供完整的社交功能覆盖内容发布、点赞、关注和评论等核心互动场景。通过真实的数据模拟还原实际社交平台的使用体验，为用户测试和演示提供便利。采用模块化设计理念保证系统的灵活扩展性，便于后续功能迭代和优化。

## 11. 后续优化方向

### 11.1 功能扩展

未来计划在现有功能基础上进一步扩展系统能力，包括实现图片上传服务增强内容表现形式，构建消息通知系统提升用户互动体验，开发搜索功能方便内容发现，以及增加数据统计分析支持运营决策。

### 11.2 性能优化

性能优化方面将重点开展数据库查询优化提升数据访问效率，引入缓存机制减少重复计算和数据库压力，实施 API 响应压缩技术降低网络传输开销，全面提升系统响应速度和并发处理能力。

### 11.3 安全加固

安全层面计划引入 JWT 令牌认证机制加强身份验证安全性，实施数据加密保护敏感信息，建立 API 访问限流策略防止恶意请求，构建多层次的安全防护体系保障系统数据安全。